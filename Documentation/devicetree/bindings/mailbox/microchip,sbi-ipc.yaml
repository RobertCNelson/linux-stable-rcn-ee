# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: "http://devicetree.org/schemas/mailbox/microchip,sbi-ipc.yaml#"
$schema: "http://devicetree.org/meta-schemas/core.yaml#"

title: Microchip Inter-processor communication (IPC) mailbox controller

maintainers:
  - Valentina Fernandez <valentina.fernandezalanis@microchip.com>

description:
  The Microchip Inter-processor Communication (IPC) is used to exchange
  data between processors. It provides the ability to send and receive
  messages through a non-blocking interrupt signaling mechanism.
  This SBI interface is compatible with the Mi-V Inter-hart
  Communication (IHC) IP.
  The microchip,sbi-ipc compatible string is inteded for use by software
  running in s-mode. The SoC-specific compatibles are inteded for use
  by the SBI implementation (m-mode).

properties:
  compatible:
    enum:
      - microchip,sbi-ipc
      - microchip,miv-ihc-rtl-v2

  interrupts:
    minItems: 1
    maxItems: 5

  interrupt-names:
    minItems: 1
    maxItems: 5

  "#mbox-cells":
    description:
      For the SBI "device", the cell represents the global "logical" channel IDs.
      The meaning of channel IDs are platform firmware dependent. The
      SoC-specific compatibles are intended for use by the SBI implementation,
      rather than s-mode software. There the cell would represent the physical
      channel and do not vary depending on platform firmware.
    const: 1

required:
  - compatible
  - interrupts
  - interrupt-names
  - "#mbox-cells"

additionalProperties: false

allOf:
  - if:
      properties:
        compatible:
          contains:
            const: microchip,sbi-ipc
    then:
      properties:
        reg: false
    else:
      required:
        - reg

  - if:
      properties:
        compatible:
          contains:
            const: microchip,miv-ihc-rtl-v2
    then:
      properties:
        interrupts:
          maxItems: 5
        interrupt-names:
          items:
            - pattern: ^hart-\d+$

examples:
  - |
    ihc: mailbox {
      compatible = "microchip,sbi-ipc";
      interrupt-parent = <&plic>;
      interrupts = <180>;
      interrupt-names = "hart1";
      #mbox-cells = <1>;
    };
